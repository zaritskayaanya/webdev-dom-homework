<!DOCTYPE html>
<html>
  <head>
    <title>Проект "Комменты"</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="styles.css" />
  </head>

  <body>
    <div class="container">
      <ul class="comments">
        <li class="comment">
          <div class="comment-header">
            <div>Глеб Фокин</div>
            <div>12.02.22 12:18</div>
          </div>
          <div class="comment-body">
            <div class="comment-text">
              Это будет первый комментарий на этой странице
            </div>
          </div>
          <div class="comment-footer">
            <div class="likes">
              <span class="likes-counter">3</span>
              <button class="like-button"></button>
            </div>
          </div>
        </li>
        <li class="comment">
          <div class="comment-header">
            <div>Варвара Н.</div>
            <div>13.02.22 19:22</div>
          </div>
          <div class="comment-body">
            <div class="comment-text">
              Мне нравится как оформлена эта страница! ❤
            </div>
          </div>
          <div class="comment-footer">
            <div class="likes">
              <span class="likes-counter">75</span>
              <button class="like-button -active-like"></button>
            </div>
          </div>
        </li>
      </ul>
      <div class="add-form">
        <input
          type="text"
          class="add-form-name"
          placeholder="Введите ваше имя"
        />
        <textarea
          type="textarea"
          class="add-form-text"
          placeholder="Введите ваш коментарий"
          rows="4"
        ></textarea>
        <div class="add-form-row">
          <button class="add-form-button">Написать</button>
        </div>
      </div>
    </div>
  </body>

  <script>
 "use strict";

const commentsContainer = document.getElementById('comments');
const nameInput = document.querySelector('.add-form-name');
const textInput = document.querySelector('.add-form-text');
const btnAdd = document.querySelector('.add-form-button');

// Изначальные комментарии
let commentsData = [
  {
    name: "Глеб Фокин",
    date: "12.02.22 12:18",
    text: "Это будет первый комментарий на этой странице",
    likesCount: 3,
    liked: false,
  },
  {
    name: "Варвара Н.",
    date: "13.02.22 19:22",
    text: "Мне нравится как оформлена эта страница! ❤",
    likesCount: 75,
    liked: true,
  },
];

//- Функция для безопасного отображения текста
function escapeHTML(str) {
  return str.replaceAll('&', '&amp;')
            .replaceAll('<', '&lt;')
            .replaceAll('>', '&gt;')
            .replaceAll('"', '&quot;')
            .replaceAll("'", '&#39;');
}

//- Рисуем все комментарии
function renderComments() {
  commentsContainer.innerHTML = '';
  commentsData.forEach((comment, index) => {
    const li = document.createElement('li');
    li.className = 'comment';
    li.setAttribute('data-index', index);
    li.innerHTML = `
      <div class="comment-header">
        <div>${escapeHTML(comment.name)}</div>
        <div>${escapeHTML(comment.date)}</div>
      </div>
      <div class="comment-body">
        <div class="comment-text">${escapeHTML(comment.text)}</div>
      </div>
      <div class="comment-footer">
        <button class="like-button ${comment.liked ? '-active-like' : ''}"></button>
        <span style="margin-left:8px;">${comment.likesCount}</span>
      </div>
    `;
    commentsContainer.appendChild(li);
  });
  // Обработчики лайков
  document.querySelectorAll('.like-button').forEach((btn, idx) => {
    btn.addEventListener('click', (e) => {
      e.stopPropagation(); // чтобы не было цитирования
      toggleLike(idx);
    });
  });
}

//- Лайк
function toggleLike(index) {
  const comment = commentsData[index];
  if (comment.liked) {
    comment.likesCount--;
    comment.liked = false;
  } else {
    comment.likesCount++;
    comment.liked = true;
  }
  renderComments();
}

//- Обработка клика по комментариям
commentsContainer.addEventListener('click', (e) => {
  const commentEl = e.target.closest('.comment');
  if (!commentEl) return;
  // исключаем клики по лайкам
  if (e.target.classList.contains('like-button')) {
    return;
  }
  const index = parseInt(commentEl.getAttribute('data-index'));
  const comment = commentsData[index];

  // вставляем имя и цитату
  nameInput.value = comment.name;

  // Вставляем цитату с символом >
  const quotedText = "> " + escapeHTML(comment.text).replaceAll('\n', '\n> ');
  textInput.value = quotedText;
});

//- Обработка добавления комментария
btnAdd.addEventListener('click', () => {
  const nameRaw = nameInput.value.trim();
  const textRaw = textInput.value.trim();

  if (!nameRaw || !textRaw) {
    alert('Пожалуйста, заполните все поля');
    return;
  }

  const name = escapeHTML(nameRaw);
  let text = escapeHTML(textRaw);

  const now = new Date();
  const dateStr = [
    String(now.getDate()).padStart(2, '0'),
    String(now.getMonth() + 1).padStart(2, '0'),
    now.getFullYear()
  ].join('.') + ' ' + [
    String(now.getHours()).padStart(2, '0'),
    String(now.getMinutes()).padStart(2, '0')
  ].join(':');

  commentsData.push({
    name,
    date: dateStr,
    text,
    likesCount: 0,
    liked: false,
  });

  renderComments();
  nameInput.value = '';
  textInput.value = '';
});

//- Первоначальный рендер
renderComments();
    
    console.log("It works!");
    </script>
</html>